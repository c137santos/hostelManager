<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="style/styles.css">
    <title>Manga Rosa Hostel</title>
</head>
<body>
    <h1>Manga Rosa Hostel</h1>

    <div class="horizontal-container" id="rooms-container" style="display: flex; align-items: baseline;">
    </div>

    <form id="form-container" class="form-container">
        <div class="form-group">
            <label for="name">Nome: </label>
            <input type="text" id="name" name="name" required>
        </div>

        <div class="form-group">
            <label for="age">Idade: </label>
            <input type="number" id="age" name="age" required>
        </div>

        <input type="hidden" id="roomId" name="roomId" required>
        <div>
            Código da Reserva:
            <p hx-target="#bookingcode"></p>
         </div>
        <div style="display: flex;align-items: baseline;justify-content: space-between;">
            <button type="submit" id="reserve" class="btn">Reservar</button>
            <button type="button" id="edit" class="btn" disabled>Editar</button>
        </div>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetch('http://127.0.0.1:8080/')
                .then(response => response.json())
                .then(rooms => {
                    const roomsContainer = document.getElementById('rooms-container');
                    const roomIdInput = document.getElementById('roomId');

                    rooms.forEach(room => {
                        const roomButton = document.createElement('button');
                        roomButton.textContent = room.name;
                        roomButton.classList.add('room-btn');
                        roomButton.onclick = () => {
                            document.querySelectorAll('.room-btn').forEach(btn => {
                                btn.classList.remove('selected');
                            });
                            roomButton.classList.add('selected');
                            roomIdInput.value = room.id;
                        };

                        roomsContainer.appendChild(roomButton);
                    });
                })
                .catch(error => console.error('Erro ao carregar os quartos:', error));

            const form = document.getElementById('form-container');
            const editButton = document.getElementById('edit');
            const reserveButton = document.getElementById('reserve');
            form.addEventListener('submit', function(event) {
                event.preventDefault();

                Swal.fire({
                    title: 'Confirm',
                    text: 'Confirma sua reserva?',
                    showCancelButton: true,
                    confirmButtonText: 'Sim',
                    cancelButtonText: 'Não'
                }).then((result) => {
                    if (result.isConfirmed) {
                        const formData = new FormData(form);
                        const data = Object.fromEntries(formData.entries());
                        fetch('http://127.0.0.1:8080/reservar', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(data)
                        })
                        .then(response => response.json())
                        .then(result => {
                            Swal.fire('Reservado', 'Sua reserva foi confirmada', 'success');
                            const inputs = form.querySelectorAll('input, button');
                            inputs.forEach(input => input.disabled = true);
                            reserveButton.disabled = true;
                            editButton.disabled = false;
                        })
                        .catch(error => {
                            Swal.fire('Erro', 'Ocorreu um erro ao fazer a reserva')
                            console.error(error)
                        })
                    } else if (result.dismiss === Swal.DismissReason.cancel) {
                        Swal.fire('Cancelado', 'Sua reserva não foi confirmada', 'error');
                    }
                });
            });

            editButton.addEventListener('click', function() {
                const inputs = form.querySelectorAll('input, button');
                inputs.forEach(input => input.disabled = false);
                editButton.disabled = true; // Desabilitar o botão Editar novamente
                reserveButton.disabled = false; // Habilitar o botão Reservar novamente
            });
        });
    </script>
</body>
</html>